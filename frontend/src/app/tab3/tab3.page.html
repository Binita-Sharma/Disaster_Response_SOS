<ion-header [translucent]="true" class="profile-header">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-button (click)="triggerCelebration()">
        <ion-icon slot="icon-only" name="sparkles" class="celebrate-icon"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title class="header-title">Disaster Response Profile</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="toggleEditMode()">
        <ion-icon [name]="isEditMode ? 'checkmark-circle' : 'pencil'" class="edit-mode-icon"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="profile-content" (ionScroll)="handleScroll($event)">
  <!-- Profile Hero Section -->
  <div class="profile-hero" [class.scrolled]="contentScrolled">
    <div class="profile-background"></div>
    <div class="profile-content-wrapper">
      <div class="avatar-container" (click)="changeProfilePhoto()" [class.edit-active]="isEditMode">
        <ion-avatar class="user-avatar">
          <img [src]="user.profileImage || 'assets/images/default-avatar.png'" alt="User profile" />
          <div class="edit-badge" *ngIf="isEditMode">
            <ion-icon name="camera"></ion-icon>
          </div>
        </ion-avatar>
        <div class="verification-badge" *ngIf="user.isVerified">
          <ion-icon name="checkmark-circle"></ion-icon>
        </div>
      </div>

      <div class="user-info">
        <h2 class="user-name" [contentEditable]="isEditMode">{{ user.name }}</h2>
        <p class="user-role">{{ user.role }}</p>
        <ion-chip outline color="warning" class="response-level">
          <ion-icon name="alert-circle"></ion-icon>
          <ion-label>Response Level: {{ user.responseLevel }}</ion-label>
        </ion-chip>
      </div>
    </div>

    <div class="quick-stats">
      <div class="stat-item" *ngFor="let stat of quickStats" (click)="stat.action()">
        <div class="stat-value">{{ stat.value }}</div>
        <div class="stat-label">{{ stat.label }}</div>
      </div>
    </div>
  </div>

  <!-- Emergency Information Section -->
  <ion-card class="emergency-card">
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="warning" class="section-icon"></ion-icon>
        Emergency Information
      </ion-card-title>
      <ion-button fill="clear" size="small" (click)="editEmergencyInfo()">
        <ion-icon name="pencil" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-card-header>

    <ion-list lines="none">
      <ion-item>
        <ion-icon slot="start" name="medkit" color="danger"></ion-icon>
        <ion-label>
          <h3>Blood Type</h3>
          <p>{{ user.medicalInfo.bloodType || 'Not specified' }}</p>
        </ion-label>
      </ion-item>
      <ion-item>
        <ion-icon slot="start" name="alert-circle" color="warning"></ion-icon>
        <ion-label>
          <h3>Allergies</h3>
          <p>{{ user.medicalInfo.allergies?.join(', ') || 'None reported' }}</p>
        </ion-label>
      </ion-item>
      <ion-item>
        <ion-icon slot="start" name="heart" color="danger"></ion-icon>
        <ion-label>
          <h3>Emergency Contacts</h3>
          <p>{{ emergencyContacts.length }} contacts registered</p>
        </ion-label>
        <ion-button slot="end" fill="clear" (click)="manageContacts()">
          <ion-icon name="chevron-forward" slot="icon-only"></ion-icon>
        </ion-button>
      </ion-item>
    </ion-list>
  </ion-card>

  <!-- Disaster Preparedness Section -->
  <ion-card class="preparedness-card">
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="shield-checkmark" class="section-icon"></ion-icon>
        My Preparedness
      </ion-card-title>
      <ion-badge color="success" mode="ios">{{ preparednessScore }}/100</ion-badge>
    </ion-card-header>

    <ion-list lines="none">
      <ion-item *ngFor="let item of preparednessItems">
        <ion-icon [name]="item.icon" slot="start" [color]="item.completed ? 'success' : 'medium'"></ion-icon>
        <ion-label>
          <h3>{{ item.name }}</h3>
          <p>{{ item.description }}</p>
        </ion-label>
        <ion-toggle slot="end" [(ngModel)]="item.completed" (ionChange)="updatePreparedness()"></ion-toggle>
      </ion-item>
    </ion-list>
  </ion-card>

  <!-- App Settings Section -->
  <ion-card class="settings-card">
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="settings" class="section-icon"></ion-icon>
        App Configuration
      </ion-card-title>
    </ion-card-header>

    <ion-list lines="none">
      <ion-item button (click)="toggleDarkMode()">
        <ion-icon name="moon" slot="start" color="tertiary"></ion-icon>
        <ion-label>Dark Mode</ion-label>
        <ion-toggle slot="end" [(ngModel)]="settings.darkMode"></ion-toggle>
      </ion-item>
      <ion-item button (click)="toggleEmergencyAlerts()">
        <ion-icon name="notifications" slot="start" color="warning"></ion-icon>
        <ion-label>Emergency Alerts</ion-label>
        <ion-toggle slot="end" [(ngModel)]="settings.emergencyAlerts"></ion-toggle>
      </ion-item>
      <ion-item button (click)="openLocationSettings()">
        <ion-icon name="location" slot="start" color="primary"></ion-icon>
        <ion-label>Location Sharing</ion-label>
        <ion-toggle slot="end" [(ngModel)]="settings.locationSharing"></ion-toggle>
      </ion-item>
    </ion-list>
  </ion-card>

  <!-- Action Buttons -->
  <div class="action-buttons">
    <ion-button expand="block" fill="outline" color="medium" (click)="openTraining()">
      <ion-icon name="school" slot="start"></ion-icon>
      Training Resources
    </ion-button>
    <ion-button expand="block" color="danger" (click)="confirmLogout()">
      <ion-icon name="log-out" slot="start"></ion-icon>
      Sign Out
    </ion-button>
  </div>

  <!-- Celebration Elements -->
  <div class="confetti-container" *ngIf="showConfetti">
    <div class="confetti" *ngFor="let confetti of confettiPieces" [style.left.px]="confetti.left"
      [style.animation-delay.ms]="confetti.delay" [style.background]="confetti.color"></div>
  </div>
</ion-content>